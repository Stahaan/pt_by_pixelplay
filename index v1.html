<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PT by PixelPlay</title>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; background: #181818; }
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        #main-logo {
            font-family: monospace;
            font-size: 2.2em;
            color: #fff;
            margin-bottom: 18px;
            text-align: center;
            letter-spacing: 2px;
            animation: breathe 2.4s ease-in-out infinite;
            user-select: none;
        }
        @keyframes breathe {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.08); opacity: 0.85; }
            100% { transform: scale(1); opacity: 1; }
        }
        canvas { background: #222; display: block; margin: 0 auto; image-rendering: pixelated; border-radius: 12px; }
        .btn, .music-btn {
            position: absolute; font-family: monospace; font-size: 1.2em;
            background: #ff9800; color: #fff; border: 2px solid #fff; border-radius: 8px;
            padding: 10px 24px; cursor: pointer; margin: 8px;
            transition: background 0.2s, color 0.2s;
            box-shadow: 0 2px 8px #0004;
        }
        .btn:hover, .music-btn:hover { background: #ffa726; color: #222; }
        #ui { position: absolute; top: 0; left: 0; width: 100%; pointer-events: none; }
        #logo { position: absolute; top: 16px; left: 16px; font-family: monospace; font-size: 1.4em; color: #fff; pointer-events: none; }
        #score, #highscore { position: absolute; top: 16px; right: 16px; font-family: monospace; color: #fff; font-size: 1.1em; text-align: right; }
        #music { position: absolute; bottom: 16px; left: 16px; }
        #home, #restart { position: absolute; bottom: 16px; right: 16px; }
        #restart { right: 120px; }
        /* Orange accent for score */
        #score, #highscore { color: #ff9800; text-shadow: 1px 1px 2px #000a; }
        /* Hide logo in-corner on title */
        .hide { display: none !important; }
    </style>
</head>
<body>
<div id="main-logo">PT by <span style="color:#ff9800">PixelPlay</span></div>
<canvas id="game" width="480" height="320"></canvas>
<div id="ui">
    <div id="logo">PT by <span style="color:#ff9800">PixelPlay</span></div>
    <div id="score"></div>
    <div id="highscore"></div>
    <button id="music" class="music-btn" title="Music"><i class="fas fa-music"></i></button>
    <button id="home" class="btn" style="display:none;" title="Home"><i class="fas fa-home"></i></button>
    <button id="restart" class="btn" style="display:none;" title="Restart"><i class="fas fa-redo"></i></button>
</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;
const logo = document.getElementById('logo');
const mainLogo = document.getElementById('main-logo');
const scoreDiv = document.getElementById('score');
const highscoreDiv = document.getElementById('highscore');
const musicBtn = document.getElementById('music');
const homeBtn = document.getElementById('home');
const restartBtn = document.getElementById('restart');

let mode = 'title'; // title, portal, lockon, gameover
let score = 0, highscore = 0, misses = 0, musicOn = true;
let portalGame = null, lockonGame = null, lastMode = '';
let musicAudio = null;

// --- Music (placeholder) ---
function playMusic() {
    if (!musicAudio) {
        musicAudio = new Audio('https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b7b7e2.mp3');
        musicAudio.loop = true;
        musicAudio.volume = 0.2;
    }
    if (musicOn) musicAudio.play();
}
function stopMusic() { if (musicAudio) musicAudio.pause(); }
musicBtn.onclick = () => {
    musicOn = !musicOn;
    musicBtn.innerHTML = musicOn ? '<i class="fas fa-music"></i>' : '<i class="fas fa-volume-mute"></i>';
    if (musicOn) playMusic(); else stopMusic();
};

// --- UI Buttons ---
function showButtons(home, restart) {
    homeBtn.style.display = home ? '' : 'none';
    restartBtn.style.display = restart ? '' : 'none';
}
homeBtn.onclick = () => { setMode('title'); };
restartBtn.onclick = () => { setMode(lastMode); };

// --- Title Screen ---
function drawTitle() {
    ctx.clearRect(0,0,W,H);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 32px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('PT by PixelPlay', W/2, 80);
    ctx.font = '18px monospace';
    ctx.fillStyle = '#ff9800';
    ctx.fillText('A 2-in-1 Pixel Game', W/2, 120);

    // Buttons
    drawButton(W/2-110, 160, 220, 48, 'Start Portal Runner', () => setMode('portal'), 'running');
    drawButton(W/2-110, 220, 220, 48, 'Start Lock-On Legends', () => setMode('lockon'), 'crosshairs');
    ctx.font = '12px monospace';
    ctx.fillStyle = '#aaa';
    ctx.fillText('Â© PixelPlay', W/2, H-16);
}
function drawButton(x, y, w, h, text, onClick, icon) {
    ctx.save();
    ctx.fillStyle = '#ff9800';
    ctx.strokeStyle = '#fff';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.rect(x, y, w, h);
    ctx.fill();
    ctx.stroke();
    ctx.fillStyle = '#fff';
    ctx.font = '16px monospace';
    ctx.textAlign = 'center';
    // Draw icon if provided
    if (icon) {
        ctx.font = '20px "Font Awesome 5 Free", monospace';
        ctx.fillText(icon === 'running' ? '\uf70c' : '\uf05b', x+w/2-60, y+h/2+7); // Unicode for running/crosshairs
    }
    ctx.font = '16px monospace';
    ctx.fillText(text, x+w/2, y+h/2+6);
    ctx.restore();

    // Button click detection
    canvas.addEventListener('mousedown', function handler(e) {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left, my = e.clientY - rect.top;
        if (mx >= x && mx <= x+w && my >= y && my <= y+h) {
            canvas.removeEventListener('mousedown', handler);
            onClick();
        }
    });
}

// --- Portal Runner ---
function PortalRunner() {
    let player = { x: 60, y: H-60, vy: 0, w: 24, h: 24, onGround: false };
    let platforms = [], portals = [], particles = [];
    let gravity = 0.8, jumpV = -11, speed = 3, t = 0, gameover = false;
    let lastPlatformX = 0;

    function reset() {
        player.x = 60; player.y = H-60; player.vy = 0; player.onGround = false;
        platforms = [{x:0,y:H-36,w:W,h:16}];
        portals = [];
        particles = [];
        speed = 3; t = 0; score = 0; gameover = false;
        lastPlatformX = 0;
    }
    reset();

    function update() {
        t++;
        if (t%180==0) speed += 0.3;

        player.vy += gravity;
        player.y += player.vy;
        player.x += speed/2;

        player.onGround = false;
        for (let pf of platforms) {
            if (player.x+player.w > pf.x && player.x < pf.x+pf.w &&
                player.y+player.h > pf.y && player.y+player.h < pf.y+16 &&
                player.vy >= 0) {
                player.y = pf.y-player.h;
                player.vy = 0;
                player.onGround = true;
            }
        }

        if (platforms.length<6) {
            let last = platforms[platforms.length-1];
            let px = last.x+last.w+Math.random()*60+40;
            let pw = 60+Math.random()*60;
            let py = H-36-Math.random()*80;
            platforms.push({x:px, y:py, w:pw, h:16});
            if (Math.random()<0.4) {
                portals.push({x:px+pw/2-12, y:py-20, w:24, h:24, type:Math.random()<0.5?'tele':'score', active:true});
            }
        }

        for (let pf of platforms) pf.x -= speed;
        for (let pt of portals) pt.x -= speed;

        platforms = platforms.filter(pf=>pf.x+pf.w>0);
        portals = portals.filter(pt=>pt.x+pt.w>0 && pt.active);

        for (let pt of portals) {
            if (pt.active && player.x+player.w>pt.x && player.x<pt.x+pt.w &&
                player.y+player.h>pt.y && player.y<pt.y+pt.h) {
                pt.active = false;
                if (pt.type=='tele') {
                    let next = platforms.find(pf=>pf.x>player.x+40);
                    if (next) {
                        player.x = next.x+10;
                        player.y = next.y-24;
                        particles.push(...makeParticles(player.x+12, player.y+12, '#ff9800'));
                    }
                } else {
                    score += 10;
                    particles.push(...makeParticles(pt.x+12, pt.y+12, '#ff9800'));
                }
            }
        }

        score += 1;

        for (let p of particles) {
            p.x += p.vx; p.y += p.vy; p.life--;
        }
        particles = particles.filter(p=>p.life>0);

        if (player.y > H) {
            gameover = true;
            setTimeout(()=>setMode('gameover'), 800);
        }
    }

    function jump() {
        if (player.onGround) {
            player.vy = jumpV;
            particles.push(...makeParticles(player.x+12, player.y+24, '#fff'));
        }
    }

    function draw() {
        ctx.clearRect(0,0,W,H);
        for (let pf of platforms) {
            ctx.fillStyle = '#444';
            ctx.fillRect(pf.x, pf.y, pf.w, pf.h);
        }
        for (let pt of portals) {
            ctx.save();
            ctx.globalAlpha = 0.7+0.3*Math.sin(perfNow()/120+pt.x);
            ctx.strokeStyle = '#ff9800';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(pt.x+12, pt.y+12, 12, 0, 2*Math.PI);
            ctx.stroke();
            ctx.restore();
        }
        ctx.fillStyle = '#fff';
        ctx.fillRect(player.x, player.y, player.w, player.h);
        for (let p of particles) {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life/12;
            ctx.fillRect(p.x, p.y, 3, 3);
            ctx.globalAlpha = 1;
        }
    }

    function makeParticles(x, y, color) {
        let arr = [];
        for (let i=0;i<12;i++) {
            arr.push({x, y, vx:Math.cos(i/12*2*Math.PI)*2, vy:Math.sin(i/12*2*Math.PI)*2, color, life:12});
        }
        return arr;
    }

    return { update, draw, jump, reset, gameover:()=>gameover };
}

// --- Lock-On Legends ---
function LockOnLegends() {
    let targets = [], crosshair = {x:W/2, y:H/2}, t=0, gameover=false;
    let spawnRate = 60, lastSpawn = 0, lockSound = null;
    misses = 0; score = 0;

    function reset() {
        targets = [];
        t = 0; gameover = false; misses = 0; score = 0;
        spawnRate = 60; lastSpawn = 0;
    }
    reset();

    function update() {
        t++;
        if (t%1800==0 && spawnRate>20) spawnRate -= 8;

        if (t-lastSpawn > spawnRate) {
            lastSpawn = t;
            let r = 18+Math.random()*12;
            let x = r+Math.random()*(W-2*r), y = r+Math.random()*(H-2*r);
            let vx = (Math.random()-0.5)*2.5, vy = (Math.random()-0.5)*2.5;
            targets.push({x, y, r, vx, vy, hit:false});
        }

        for (let tg of targets) {
            tg.x += tg.vx; tg.y += tg.vy;
            if (tg.x<tg.r||tg.x>W-tg.r) tg.vx*=-1;
            if (tg.y<tg.r||tg.y>H-tg.r) tg.vy*=-1;
        }

        targets = targets.filter(tg=>!tg.hit);

        if (misses>=3) {
            gameover = true;
            setTimeout(()=>setMode('gameover'), 800);
        }
    }

    function lockOn(mx, my) {
        let hit = false;
        for (let tg of targets) {
            let dx = mx-tg.x, dy = my-tg.y;
            if (dx*dx+dy*dy < tg.r*tg.r) {
                tg.hit = true; hit = true; score += 10;
                playLockSound();
            }
        }
        if (!hit) {
            misses++;
            playLockSound(true);
        }
    }

    function playLockSound(miss=false) {
        if (!lockSound) {
            lockSound = new AudioContext();
        }
        let o = lockSound.createOscillator();
        let g = lockSound.createGain();
        o.type = 'square';
        o.frequency.value = miss ? 180 : 420;
        g.gain.value = 0.1;
        o.connect(g).connect(lockSound.destination);
        o.start();
        o.stop(lockSound.currentTime+0.12);
    }

    function draw() {
        ctx.clearRect(0,0,W,H);
        ctx.fillStyle = '#222';
        ctx.fillRect(0,0,W,H);
        for (let tg of targets) {
            ctx.save();
            ctx.globalAlpha = 0.8;
            ctx.fillStyle = '#ff9800';
            ctx.beginPath();
            ctx.arc(tg.x, tg.y, tg.r, 0, 2*Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.restore();
        }
        ctx.save();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(crosshair.x, crosshair.y, 18, 0, 2*Math.PI);
        ctx.moveTo(crosshair.x-24, crosshair.y);
        ctx.lineTo(crosshair.x+24, crosshair.y);
        ctx.moveTo(crosshair.x, crosshair.y-24);
        ctx.lineTo(crosshair.x, crosshair.y+24);
        ctx.stroke();
        ctx.restore();
        ctx.font = '16px monospace';
        ctx.fillStyle = '#f44';
        ctx.textAlign = 'left';
        ctx.fillText('Misses: '+misses+'/3', 12, 28);
    }

    function moveCrosshair(mx, my) {
        crosshair.x = mx; crosshair.y = my;
    }

    return { update, draw, lockOn, moveCrosshair, reset, gameover:()=>gameover };
}

// --- Main Loop ---
function setMode(m) {
    mode = m;
    lastMode = m;
    showButtons(false, false);
    if (m=='title') {
        logo.classList.add('hide');
        mainLogo.classList.remove('hide');
        scoreDiv.textContent = '';
        highscoreDiv.textContent = '';
        playMusic();
        drawTitle();
    } else if (m=='portal') {
        logo.classList.remove('hide');
        mainLogo.classList.add('hide');
        portalGame = PortalRunner();
        portalGame.reset();
        highscore = Math.max(highscore, score);
        showButtons(true, false);
        playMusic();
    } else if (m=='lockon') {
        logo.classList.remove('hide');
        mainLogo.classList.add('hide');
        lockonGame = LockOnLegends();
        lockonGame.reset();
        highscore = Math.max(highscore, score);
        showButtons(true, false);
        playMusic();
    } else if (m=='gameover') {
        logo.classList.remove('hide');
        mainLogo.classList.add('hide');
        showButtons(true, true);
        highscore = Math.max(highscore, score);
        drawGameOver();
        stopMusic();
    }
    updateUI();
}
function updateUI() {
    if (mode=='portal'||mode=='lockon') {
        scoreDiv.textContent = 'Score: '+score;
        highscoreDiv.textContent = 'High: '+highscore;
    } else {
        scoreDiv.textContent = '';
        highscoreDiv.textContent = '';
    }
}
function drawGameOver() {
    ctx.save();
    ctx.globalAlpha = 0.8;
    ctx.fillStyle = '#000';
    ctx.fillRect(0,0,W,H);
    ctx.globalAlpha = 1;
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 32px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Game Over', W/2, H/2-24);
    ctx.font = '18px monospace';
    ctx.fillStyle = '#ff9800';
    ctx.fillText('Score: '+score, W/2, H/2+8);
    ctx.fillText('High Score: '+highscore, W/2, H/2+36);
    ctx.font = '14px monospace';
    ctx.fillStyle = '#aaa';
    ctx.fillText('Press Restart or Home', W/2, H/2+64);
    ctx.restore();
}

// --- Input ---
window.addEventListener('keydown', e=>{
    if (mode=='portal' && (e.code=='Space'||e.code=='ArrowUp')) portalGame.jump();
});
canvas.addEventListener('mousedown', e=>{
    const rect = canvas.getBoundingClientRect();
    const mx = e.clientX - rect.left, my = e.clientY - rect.top;
    if (mode=='portal') portalGame.jump();
    if (mode=='lockon') lockonGame.lockOn(mx, my);
});
canvas.addEventListener('touchstart', e=>{
    const rect = canvas.getBoundingClientRect();
    const touch = e.touches[0];
    const mx = touch.clientX - rect.left, my = touch.clientY - rect.top;
    if (mode=='portal') portalGame.jump();
    if (mode=='lockon') lockonGame.lockOn(mx, my);
});
canvas.addEventListener('mousemove', e=>{
    if (mode=='lockon') {
        const rect = canvas.getBoundingClientRect();
        lockonGame.moveCrosshair(e.clientX-rect.left, e.clientY-rect.top);
    }
});
canvas.addEventListener('touchmove', e=>{
    if (mode=='lockon') {
        const rect = canvas.getBoundingClientRect();
        const touch = e.touches[0];
        lockonGame.moveCrosshair(touch.clientX-rect.left, touch.clientY-rect.top);
    }
});

// --- Animation Loop ---
function perfNow() { return performance.now(); }
function loop() {
    if (mode=='title') {
        drawTitle();
    } else if (mode=='portal') {
        portalGame.update();
        portalGame.draw();
        updateUI();
    } else if (mode=='lockon') {
        lockonGame.update();
        lockonGame.draw();
        updateUI();
    }
    requestAnimationFrame(loop);
}
setMode('title');
loop();
</script>
</body>
</html>